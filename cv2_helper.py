import numpy as np


# ====================================================================================================================================================================
# 1. Linear Independence
# ====================================================================================================================================================================
def is_lin_ind(*vectors):
    A = np.row_stack(vectors)
    U, s, V = np.linalg.svd(A)

    if len(vectors[0]) > s.shape[0]:
        return False

    for i in s:
        if i < 1e-5:
            return False
    
    return True
# ====================================================================================================================================================================


# ====================================================================================================================================================================
# 2. Calculate the pixel-position of the projected point (u, v) in the image and tick the correct answer
# ====================================================================================================================================================================
def pixel_pos_of_proj_point(P=None, C=np.array([[0, 0, 0]]).T, K=None, print_steps=False):
    assert(P is not None and K is not None)  # TEST

    # Generic projection matrix
    PI = np.array([
        [1, 0, 0, 0],
        [0, 1, 0, 0],
        [0, 0, 1, 0]
    ])

    # Translator (-C)
    T = np.array([
        [1, 0, 0, 0],
        [0, 1, 0, 0],
        [0, 0, 1, 0],
        [0, 0, 0, 1]
    ])
    T[:, 3] = np.append(-C, [1])

    # Cam coordinates
    PC = np.array([np.append(P, [1])]).T

    # Print inputs
    if print_steps:
        print("Inputs:")

        # Print inputs
        print("P:", P)
        print("C:", C)
        print("K:", K)
        print("Generic projection matrix:", PI)
        print("Translator (-C):", T)
        print("Cam coordinates:", PC, end="\n\n")

    # ======================================
    # Calculation
    # ======================================
    i1 = np.dot(K, PI)
    i2 = np.dot(i1, T)
    i3 = np.dot(i2, PC)

    final = i3

    # Print final
    if print_steps:
        print("Final: ", final, end="\n\n")

    # Print the solutioon: projected point (u, v)
    lamb, u, v = (final[2])[0], (final[0] / final[2])[0], (final[1] / final[2])[0]
    return lamb, u, v
# ====================================================================================================================================================================


# ====================================================================================================================================================================
# 3. ??
# ====================================================================================================================================================================

